{% extends "laporan_keuangan/base.html" %}

{% block title %}Dashboard - Sistem Akuntansi{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1">Dashboard Keuangan</h1>
            <p class="text-muted mb-0">Ringkasan visual periode akuntansi</p>
        </div>
    </div>

    <!-- Period Selector Card -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="card-title mb-3">
                        <i class="bi bi-calendar-range text-primary me-2"></i>
                        Periode Akuntansi
                    </h5>
                    <form method="post" class="d-flex gap-2 align-items-center">
                        {% csrf_token %}
                        <select name="period_id" class="form-select" style="max-width: 300px;"
                            onchange="this.form.submit()">
                            {% for p in periods %}
                            <option value="{{ p.id }}" {% if p.id == active_period.id %}selected{% endif %}>
                                {{ p.nama }}
                            </option>
                            {% endfor %}
                        </select>
                        <noscript>
                            <button type="submit" class="btn btn-primary">Pilih</button>
                        </noscript>
                    </form>
                </div>
                <div class="col-md-6 text-md-end mt-3 mt-md-0">
                    {% if period_start and period_end %}
                    <div class="period-badge">
                        <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2">
                            <i class="bi bi-clock-history me-1"></i>
                            {{ period_start }} â€” {{ period_end }}
                        </span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Charts Section -->
    <div class="row g-4 mb-4">
        <div class="col-12">
            <h5 class="text-muted mb-3">
                <i class="bi bi-graph-up me-2"></i>
                Ringkasan Periode
            </h5>
            <p class="small text-muted">
                <i class="bi bi-info-circle me-1"></i>
                Grafik di bawah adalah ilustrasi visual untuk membantu pemahaman struktur laporan keuangan.
                Untuk data aktual, silakan buka masing-masing laporan.
            </p>
        </div>
    </div>

    <div class="row g-4">
        <!-- Neraca Chart (Balance Sheet) -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white border-bottom-0 pt-3">
                    <h6 class="mb-0">
                        <i class="bi bi-pie-chart text-info me-2"></i>
                        Struktur Neraca
                    </h6>
                    <small class="text-muted">Proporsi Aset, Liabilitas, dan Ekuitas</small>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="neracaChart"></canvas>
                    </div>
                </div>
                <div class="card-footer bg-white border-top-0">
                    <a href="{% url 'finance:neraca' %}" class="btn btn-outline-info btn-sm">
                        <i class="bi bi-arrow-right me-1"></i>Lihat Laporan Neraca
                    </a>
                </div>
            </div>
        </div>

        <!-- Laba Rugi Chart (Income Statement) -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white border-bottom-0 pt-3">
                    <h6 class="mb-0">
                        <i class="bi bi-bar-chart text-success me-2"></i>
                        Perbandingan Laba Rugi
                    </h6>
                    <small class="text-muted">Pendapatan vs Beban</small>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="labaRugiChart"></canvas>
                    </div>
                </div>
                <div class="card-footer bg-white border-top-0">
                    <a href="{% url 'finance:laba_rugi' %}" class="btn btn-outline-success btn-sm">
                        <i class="bi bi-arrow-right me-1"></i>Lihat Laporan Laba Rugi
                    </a>
                </div>
            </div>
        </div>

        <!-- Arus Kas Overview -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white border-bottom-0 pt-3">
                    <h6 class="mb-0">
                        <i class="bi bi-cash-stack text-warning me-2"></i>
                        Komponen Arus Kas
                    </h6>
                    <small class="text-muted">Operasi, Investasi, dan Pendanaan</small>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="arusKasChart"></canvas>
                    </div>
                </div>
                <div class="card-footer bg-white border-top-0">
                    <a href="{% url 'finance:arus_kas' %}" class="btn btn-outline-warning btn-sm">
                        <i class="bi bi-arrow-right me-1"></i>Lihat Laporan Arus Kas
                    </a>
                </div>
            </div>
        </div>

        <!-- Ekuitas Overview -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white border-bottom-0 pt-3">
                    <h6 class="mb-0">
                        <i class="bi bi-diagram-3 text-primary me-2"></i>
                        Perubahan Ekuitas
                    </h6>
                    <small class="text-muted">Saldo Awal vs Perubahan vs Saldo Akhir</small>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="ekuitasChart"></canvas>
                    </div>
                </div>
                <div class="card-footer bg-white border-top-0">
                    <a href="{% url 'finance:perubahan_ekuitas' %}" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-arrow-right me-1"></i>Lihat Laporan Perubahan Ekuitas
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Links Section -->
    <div class="row g-4 mt-2">
        <div class="col-12">
            <h5 class="text-muted mb-3">
                <i class="bi bi-lightning me-2"></i>
                Akses Cepat
            </h5>
        </div>
        <div class="col-md-4">
            <a href="{% url 'finance:input_transaksi' %}" class="card shadow-sm text-decoration-none quick-link-card">
                <div class="card-body text-center py-4">
                    <i class="bi bi-pencil-square text-primary fs-1 mb-3 d-block"></i>
                    <h6 class="mb-1">Input Transaksi</h6>
                    <small class="text-muted">Tambah jurnal baru</small>
                </div>
            </a>
        </div>
        <div class="col-md-4">
            <a href="{% url 'finance:jurnal_umum' %}" class="card shadow-sm text-decoration-none quick-link-card">
                <div class="card-body text-center py-4">
                    <i class="bi bi-journal-text text-info fs-1 mb-3 d-block"></i>
                    <h6 class="mb-1">Jurnal Umum</h6>
                    <small class="text-muted">Lihat transaksi periode</small>
                </div>
            </a>
        </div>
        <div class="col-md-4">
            <a href="{% url 'finance:buku_besar' %}" class="card shadow-sm text-decoration-none quick-link-card">
                <div class="card-body text-center py-4">
                    <i class="bi bi-book text-success fs-1 mb-3 d-block"></i>
                    <h6 class="mb-1">Buku Besar</h6>
                    <small class="text-muted">Saldo per akun</small>
                </div>
            </a>
        </div>
    </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
    (function () {
        'use strict';

        // Chart color palette
        const colors = {
            primary: 'rgba(59, 130, 246, 0.8)',
            success: 'rgba(16, 185, 129, 0.8)',
            warning: 'rgba(245, 158, 11, 0.8)',
            danger: 'rgba(239, 68, 68, 0.8)',
            info: 'rgba(6, 182, 212, 0.8)',
            secondary: 'rgba(107, 114, 128, 0.8)',
            purple: 'rgba(139, 92, 246, 0.8)'
        };

        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        usePointStyle: true,
                        font: { size: 11 }
                    }
                }
            }
        };

        // Initialize charts on DOM ready
        document.addEventListener('DOMContentLoaded', function () {
            // Neraca Chart (Doughnut)
            new Chart(document.getElementById('neracaChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Aset', 'Liabilitas', 'Ekuitas'],
                    datasets: [{
                        data: [60, 25, 35],
                        backgroundColor: [colors.info, colors.danger, colors.success],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    ...chartOptions,
                    cutout: '60%'
                }
            });

            // Laba Rugi Chart (Bar)
            new Chart(document.getElementById('labaRugiChart'), {
                type: 'bar',
                data: {
                    labels: ['Pendapatan', 'Beban', 'Laba Bersih'],
                    datasets: [{
                        label: 'Nilai',
                        data: [100, 70, 30],
                        backgroundColor: [colors.success, colors.danger, colors.primary],
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            ticks: { display: false }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });

            // Arus Kas Chart (Horizontal Bar)
            new Chart(document.getElementById('arusKasChart'), {
                type: 'bar',
                data: {
                    labels: ['Operasi', 'Investasi', 'Pendanaan'],
                    datasets: [{
                        label: 'Arus Kas',
                        data: [45, -20, 10],
                        backgroundColor: [colors.success, colors.warning, colors.purple],
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    ...chartOptions,
                    indexAxis: 'y',
                    plugins: {
                        ...chartOptions.plugins,
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            ticks: { display: false }
                        },
                        y: {
                            grid: { display: false }
                        }
                    }
                }
            });

            // Ekuitas Chart (Stacked Bar showing progression)
            new Chart(document.getElementById('ekuitasChart'), {
                type: 'bar',
                data: {
                    labels: ['Modal Saham', 'Laba Ditahan', 'Total Ekuitas'],
                    datasets: [
                        {
                            label: 'Saldo Awal',
                            data: [50, 20, 70],
                            backgroundColor: colors.secondary,
                            borderRadius: 4
                        },
                        {
                            label: 'Perubahan',
                            data: [0, 15, 15],
                            backgroundColor: colors.primary,
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    ...chartOptions,
                    scales: {
                        y: {
                            beginAtZero: true,
                            stacked: true,
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            ticks: { display: false }
                        },
                        x: {
                            stacked: true,
                            grid: { display: false }
                        }
                    }
                }
            });
        });
    })();
</script>

<style>
    .dashboard h1 {
        color: #1e3a5f;
    }

    .chart-container {
        position: relative;
        height: 220px;
    }

    .quick-link-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        color: inherit;
    }

    .quick-link-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1) !important;
    }

    .quick-link-card h6 {
        color: #1e3a5f;
    }

    .card {
        border: none;
        border-radius: 12px;
    }

    .card-header {
        border-radius: 12px 12px 0 0 !important;
    }

    .card-footer {
        border-radius: 0 0 12px 12px !important;
    }

    .period-badge .badge {
        font-size: 0.9rem;
        font-weight: 500;
    }
</style>
{% endblock %}